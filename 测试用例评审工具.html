<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“‹ æµ‹è¯•ç”¨ä¾‹è¯„å®¡å·¥å…· Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            padding: 20px 40px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 15px 25px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s;
            min-width: 120px;
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-value.critical {
            color: var(--danger-color);
        }

        .stat-value.high {
            color: var(--warning-color);
        }

        .stat-value.medium {
            color: #ca8a04;
        }

        .stat-value.low {
            color: #0284c7;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .toolbar {
            padding: 20px 40px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--border-color);
            background: white;
            align-items: flex-start;
            position: relative;
            min-height: 80px;
        }

        .toolbar-left {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toolbar-right {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toolbar-center {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 0 auto;
        }

        .toolbar-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 8px;
            min-width: 200px;
            box-shadow: var(--shadow-md);
        }

        .toolbar-group-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toolbar-group-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toolbar-group-buttons .btn {
            width: 100%;
            justify-content: flex-start;
            font-size: 13px;
            padding: 8px 15px;
        }

        .stats-with-toggle {
            display: flex;
            align-items: center;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #047857;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #b45309;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .file-info {
            padding: 15px 40px;
            background: #fef3c7;
            border-left: 4px solid var(--warning-color);
            font-size: 14px;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        /* äºŒçº§æ ‡é¢˜æ ‡ç­¾é¡µï¼ˆæ˜¾ç¤ºåœ¨ä¸Šæ–¹ï¼‰ */
        .h2-tabs-container {
            background: white;
            border-bottom: 2px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            display: none;
        }

        .h2-tabs-container.active {
            display: block;
        }

        .h2-tabs-header {
            display: flex;
            padding: 15px 30px;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            overflow-x: auto;
            gap: 12px;
            justify-content: center;
            align-items: center;
        }

        .h2-tabs-header::-webkit-scrollbar {
            height: 6px;
        }

        .h2-tabs-header::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .h2-tabs-header::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .h2-tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
            transition: all 0.3s;
            min-width: 140px;
            box-shadow: var(--shadow-sm);
        }

        .h2-tab:hover {
            background: #e0e7ff;
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .h2-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 16px -4px rgba(102, 126, 234, 0.4);
        }

        .h2-tab-title {
            font-weight: 600;
            font-size: 15px;
        }

        .h2-tab-count {
            font-size: 12px;
            opacity: 0.75;
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 10px;
            border-radius: 12px;
        }

        .h2-tab.active .h2-tab-count {
            opacity: 1;
            background: rgba(255, 255, 255, 0.25);
        }

        .main-content {
            display: flex;
            height: calc(100vh - 500px);
            min-height: 600px;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        .nav-item:hover {
            background: #e0e7ff;
            border-left-color: var(--primary-color);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: #dbeafe;
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .nav-item.level-3 {
            padding-left: 25px;
            font-size: 13px;
            background: #f8fafc;
        }

        .nav-item.level-3:hover {
            background: #e0e7ff;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-secondary);
            text-align: center;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px 40px;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .section:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title.level-2 {
            font-size: 18px;
            color: var(--primary-color);
        }

        .section-title.level-3 {
            font-size: 16px;
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        .test-case {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .test-case:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .test-case-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .test-case-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-critical {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .badge-high {
            background: #fed7aa;
            color: var(--warning-color);
        }

        .badge-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-low {
            background: #dbeafe;
            color: #1e40af;
        }

        .test-case-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn-review {
            background: #dbeafe;
            color: var(--primary-color);
        }

        .action-btn-review:hover {
            background: var(--primary-color);
            color: white;
        }

        .content {
            line-height: 1.8;
        }

        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            margin: 20px 0 15px 0;
            color: var(--text-primary);
        }

        .content h1 {
            font-size: 24px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .content h2 {
            font-size: 22px;
            color: var(--primary-color);
        }

        .content h3 {
            font-size: 20px;
        }

        .content h4 {
            font-size: 18px;
            color: var(--primary-color);
        }

        .content h5 {
            font-size: 16px;
        }

        .content h6 {
            font-size: 14px;
        }

        .content p {
            margin: 10px 0;
        }

        .content ul, .content ol {
            margin: 10px 0 10px 25px;
        }

        .content li {
            margin-bottom: 8px;
        }

        .content blockquote {
            border-left: 4px solid var(--primary-color);
            padding: 10px 20px;
            margin: 15px 0;
            background: var(--bg-primary);
            border-radius: 4px;
            color: var(--text-secondary);
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }

        .content thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .content td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .content tbody tr:hover {
            background: var(--bg-primary);
        }

        .content tbody tr:last-child td {
            border-bottom: none;
        }

        .content pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 13px;
            line-height: 1.6;
            box-shadow: var(--shadow-sm);
        }

        .content code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 13px;
            color: #e11d48;
        }

        .content pre code {
            background: transparent;
            padding: 0;
            color: #e2e8f0;
        }

        .content strong {
            font-weight: 700;
            color: var(--text-primary);
        }

        .content em {
            font-style: italic;
            color: var(--text-secondary);
        }

        .content a {
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        .content a:hover {
            border-bottom-color: var(--primary-color);
        }

        .review-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 8px;
            display: none;
        }

        .review-section.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .review-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s;
        }

        .review-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .review-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .review-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .review-meta input {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
        }

        .review-actions {
            display: flex;
            gap: 10px;
        }

        .review-list {
            margin-top: 15px;
        }

        .review-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .review-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .review-item-content {
            color: var(--text-primary);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        input[type="file"] {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 200px;
            }

            .stats-bar {
                padding: 15px 20px;
            }

            .toolbar {
                padding: 15px 20px;
            }

            .content-area {
                padding: 20px;
            }

            .h2-tabs-header {
                justify-content: flex-start;
                padding: 10px 20px;
            }

            .h2-tab {
                min-width: 120px;
            }

            .toolbar-left,
            .toolbar-right {
                position: relative;
                left: auto;
                right: auto;
                top: auto;
                transform: none;
                margin: 10px 0;
            }

            .stats-with-toggle {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ æµ‹è¯•ç”¨ä¾‹è¯„å®¡å·¥å…· Pro</h1>
            <p>æ”¯æŒ Markdown æ ¼å¼çš„æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£ç®¡ç†ã€å¤šæ¡è¯„å®¡ä¸å¯¼å‡º</p>
        </div>

        <div class="stats-bar">
            <div class="stats-with-toggle">
                <div class="stat-item">
                    <div class="stat-value" id="categoryCount">0</div>
                    <div class="stat-label">æµ‹è¯•ç±»åˆ«</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="testCaseCount">0</div>
                    <div class="stat-label">è¯¦ç»†æµ‹è¯•ç‚¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="reviewCount">0</div>
                    <div class="stat-label">è¯„å®¡æ„è§</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="h2TabCount">0</div>
                    <div class="stat-label">æ ‡ç­¾é¡µ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value critical" id="criticalCount">0</div>
                    <div class="stat-label">å…³é”®</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value high" id="highCount">0</div>
                    <div class="stat-label">é«˜</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value medium" id="mediumCount">0</div>
                    <div class="stat-label">ä¸­</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value low" id="lowCount">0</div>
                    <div class="stat-label">ä½</div>
                </div>
                <button class="btn btn-secondary" id="toggleAllReviewsBtn" onclick="toggleAllReviews()">
                    <span>ğŸ‘ï¸</span> æ˜¾ç¤ºæ‰€æœ‰è¯„å®¡
                </button>
            </div>
        </div>

        <div class="toolbar">
            <div class="toolbar-center"></div>
        </div>

        <!-- å·¦ä¾§æ‚¬æµ®å¯¼å…¥æŒ‰é’® -->
        <div class="toolbar-left">
            <div class="toolbar-group">
                <div class="toolbar-group-title">ğŸ“¥ å¯¼å…¥åŠŸèƒ½</div>
                <div class="toolbar-group-buttons">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        <span>ğŸ“</span> å¯¼å…¥MDæ–‡ä»¶
                    </button>
                    <input type="file" id="fileInput" accept=".md,.txt" style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('reviewTxtInput').click()">
                        <span>ğŸ“¥</span> å¯¼å…¥è¯„å®¡TXT
                    </button>
                    <input type="file" id="reviewTxtInput" accept=".txt" style="display: none;">
                    <button class="btn btn-success" onclick="reloadFile()">
                        <span>ğŸ”„</span> åˆ·æ–°æ–‡æ¡£
                    </button>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ‚¬æµ®å¯¼å‡ºæŒ‰é’® -->
        <div class="toolbar-right">
            <div class="toolbar-group">
                <div class="toolbar-group-title">ğŸ“¤ å¯¼å‡ºåŠŸèƒ½</div>
                <div class="toolbar-group-buttons">
                    <button class="btn btn-warning" onclick="exportHTMLWithReviews()">
                        <span>ğŸ“¤</span> å¯¼å‡ºæ–‡æ¡£å¸¦è¯„å®¡HTML
                    </button>
                    <button class="btn btn-warning" onclick="exportHTMLWithoutReviews()">
                        <span>ğŸ“„</span> å¯¼å‡ºæ–‡æ¡£æ— è¯„å®¡HTML
                    </button>
                    <button class="btn btn-secondary" onclick="exportHTMLReviewsOnly()">
                        <span>ğŸ“‹</span> å¯¼å‡ºçº¯è¯„å®¡HTML
                    </button>
                    <button class="btn btn-primary" onclick="exportReviewsTxt()">
                        <span>ğŸ’¾</span> å¯¼å‡ºè¯„å®¡TXT
                    </button>
                    <button class="btn btn-success" onclick="exportMarkdownTemplate()">
                        <span>ğŸ“</span> å¯¼å‡ºMDæ¨¡æ¿
                    </button>
                </div>
            </div>
        </div>

        <div class="file-info" id="fileInfo">
            ğŸ“ æœªåŠ è½½æ–‡ä»¶
        </div>

        <!-- äºŒçº§æ ‡é¢˜æ ‡ç­¾é¡µï¼ˆæ˜¾ç¤ºåœ¨ä¸Šæ–¹ï¼‰ -->
        <div class="h2-tabs-container" id="h2TabsContainer">
            <div class="h2-tabs-header" id="h2TabsHeader"></div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>ğŸ“‘ ç« èŠ‚å¯¼èˆª</h3>
                <div id="navContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div>æš‚æ— å†…å®¹</div>
                        <small>è¯·å¯¼å…¥ Markdown æ–‡ä»¶</small>
                    </div>
                </div>
            </div>

            <div class="content-area">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
                <div id="contentContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <div>æš‚æ— æ–‡æ¡£</div>
                        <small>å¯¼å…¥ Markdown æ–‡ä»¶åï¼Œå†…å®¹å°†åœ¨æ­¤å¤„æ˜¾ç¤º</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
	    <script>
        let currentFile = null;
        let currentFileName = '';
        let documentStructure = [];
        let reviews = {};
        let currentH2Tabs = [];
        let activeTabId = null;
        let h1Title = ''; // å­˜å‚¨H1æ ‡é¢˜ï¼Œç”¨äºå¯¼å‡ºæ–‡ä»¶å

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                currentFile = file;
                currentFileName = file.name;
                loadMarkdownFile(file);
            }
        });

        // è¯„å®¡TXTæ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('reviewTxtInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                importReviewsTxt(file);
            }
        });

        // åŠ è½½ Markdown æ–‡ä»¶
        function loadMarkdownFile(file) {
            const fileInfo = document.getElementById('fileInfo');
            const loading = document.getElementById('loading');
            
            loading.classList.add('active');
            fileInfo.classList.add('active');
            fileInfo.innerHTML = `ğŸ“ æ­£åœ¨åŠ è½½: ${file.name}`;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                parseMarkdown(content);
                fileInfo.innerHTML = `ğŸ“ å·²åŠ è½½: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                loading.classList.remove('active');
                updateStats();
            };
            reader.onerror = function() {
                fileInfo.innerHTML = `âŒ åŠ è½½å¤±è´¥: ${file.name}`;
                fileInfo.style.background = '#fee2e2';
                fileInfo.style.borderLeftColor = 'var(--danger-color)';
                loading.classList.remove('active');
            };
            reader.readAsText(file);
        }

        // è§£æ Markdown
        function parseMarkdown(content) {
            documentStructure = [];
            currentH2Tabs = [];
            h1Title = '';
            const lines = content.split('\n');
            
            let currentH1 = null;
            let currentH2 = null;
            let currentH3 = null;
            let contentBuffer = [];
            let isInCodeBlock = false;
            let codeBlockLang = '';
            let codeBlockContent = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmedLine = line.trim();

                // å¤„ç†ä»£ç å—
                if (trimmedLine.startsWith('```')) {  
                    if (!isInCodeBlock) {  
                        isInCodeBlock = true;  
                        codeBlockLang = trimmedLine.substring(3).trim();  
                        codeBlockContent = [];  
                    } else {  
                        isInCodeBlock = false;  
                        contentBuffer.push({  
                            type: 'code',  
                            lang: codeBlockLang,  
                            content: codeBlockContent.join('\n')  
                        });  
                        codeBlockContent = [];  
                        codeBlockLang = '';  
                    }  
                    continue;  
                }  

                if (isInCodeBlock) {  
                    codeBlockContent.push(line);  
                    continue;  
                }  

                // æ£€æµ‹æ ‡é¢˜  
                if (trimmedLine.startsWith('#')) {  
                    const level = trimmedLine.match(/^#+/)[0].length;  
                    const titleText = trimmedLine.substring(level).trim();  
                    
                    if (level === 1) {  
                        // H1: ä¿å­˜ä¹‹å‰çš„å†…å®¹  
                        saveCurrentContent(currentH3, currentH2, currentH1, contentBuffer);  
                        contentBuffer = [];  
                        
                        // ä¿å­˜H1æ ‡é¢˜ç”¨äºå¯¼å‡ºæ–‡ä»¶å  
                        if (!h1Title) {  
                            h1Title = titleText;  
                        }  
                        
                        currentH1 = {  
                            id: `h1-${documentStructure.length}`,  
                            level: 1,  
                            title: titleText,  
                            children: [],  
                            content: []  
                        };  
                        documentStructure.push(currentH1);  
                        currentH2 = null;  
                        currentH3 = null;  
                        
                    } else if (level === 2) {  
                        // H2: ä¿å­˜ä¹‹å‰çš„å†…å®¹  
                        saveCurrentContent(currentH3, currentH2, currentH1, contentBuffer);  
                        contentBuffer = [];  
                        
                        currentH2 = {  
                            id: `h2-${currentH2Tabs.length}-${Date.now()}`,  
                            level: 2,  
                            title: titleText,  
                            children: [],  
                            content: [],  
                            parent: currentH1,  
                            testCaseCount: 0,  
                            h2Index: currentH2Tabs.length // è®°å½•åœ¨H2åˆ—è¡¨ä¸­çš„ä½ç½®  
                        };  
                        
                        if (currentH1) {  
                            currentH1.children.push(currentH2);  
                        } else {  
                            documentStructure.push(currentH2);  
                        }  
                        
                        // æ·»åŠ åˆ°H2æ ‡ç­¾é¡µåˆ—è¡¨  
                        currentH2Tabs.push(currentH2);  
                        currentH3 = null;  
                        
                    } else if (level === 3) {  
                        // H3: ä¿å­˜ä¹‹å‰çš„å†…å®¹  
                        saveCurrentContent(currentH3, currentH2, currentH1, contentBuffer);  
                        contentBuffer = [];  
                        
                        const priority = detectPriority(titleText);  
                        currentH3 = {  
                            id: `h3-${currentH2 ? currentH2.id : 'root'}-${currentH2 ? currentH2.children.length : 0}-${Date.now()}`,  
                            level: 3,  
                            title: titleText,  
                            priority: priority,  
                            content: [],  
                            parent: currentH2 || currentH1  
                        };  
                        
                        // å¢åŠ H2çš„æµ‹è¯•ç‚¹è®¡æ•°  
                        if (currentH2) {  
                            currentH2.testCaseCount++;  
                        }  
                        
                        if (currentH2) {  
                            currentH2.children.push(currentH3);  
                        } else if (currentH1) {  
                            currentH1.children.push(currentH3);  
                        } else {  
                            documentStructure.push(currentH3);  
                        }  
                    } else {  
                        // H4-H6: ä½œä¸ºæ™®é€šå†…å®¹  
                        contentBuffer.push({  
                            type: 'heading',  
                            level: level,  
                            content: titleText  
                        });  
                    }  
                } else if (trimmedLine.startsWith('|')) {  
                    // è¡¨æ ¼å¤„ç†  
                    let tableLines = [line];  
                    let j = i + 1;  
                    
                    while (j < lines.length && lines[j].trim().startsWith('|')) {  
                        tableLines.push(lines[j]);  
                        j++;  
                    }  
                    
                    if (tableLines.length >= 2) {  
                        contentBuffer.push({  
                            type: 'table',  
                            content: tableLines  
                        });  
                        i = j - 1;  
                    }  
                } else if (trimmedLine.startsWith('>')) {  
                    // å¼•ç”¨å—  
                    contentBuffer.push({  
                        type: 'blockquote',  
                        content: trimmedLine.substring(1).trim()  
                    });  
                } else if (trimmedLine.match(/^[\*\-]\s/) || trimmedLine.match(/^\d+\.\s/)) {  
                    // åˆ—è¡¨é¡¹  
                    contentBuffer.push({  
                        type: 'list',  
                        content: trimmedLine  
                    });  
                } else if (trimmedLine) {  
                    // æ™®é€šæ®µè½  
                    contentBuffer.push({  
                        type: 'paragraph',  
                        content: trimmedLine  
                    });  
                }  
            }  

            // ä¿å­˜æœ€åçš„å†…å®¹  
            saveCurrentContent(currentH3, currentH2, currentH1, contentBuffer);  

            renderNavigation();  
            renderContent();  
            renderH2Tabs();  
        }  

        // ä¿å­˜å½“å‰å†…å®¹åˆ°å¯¹åº”çš„èŠ‚ç‚¹  
        function saveCurrentContent(h3, h2, h1, buffer) {  
            if (buffer.length === 0) return;  
            
            if (h3) {  
                h3.content.push(...buffer);  
            } else if (h2) {  
                h2.content.push(...buffer);  
            } else if (h1) {  
                h1.content.push(...buffer);  
            }  
        }  

        // æ£€æµ‹ä¼˜å…ˆçº§  
        function detectPriority(text) {  
            const lowerText = text.toLowerCase();  
            if (lowerText.includes('å…³é”®') || lowerText.includes('critical')) return 'critical';  
            if (lowerText.includes('é«˜') || lowerText.includes('high')) return 'high';  
            if (lowerText.includes('ä¸­') || lowerText.includes('medium')) return 'medium';  
            return 'low';  
        }  

        // æ¸²æŸ“å¯¼èˆªï¼ˆåªæ˜¾ç¤ºå½“å‰H2çš„å­æ ‡é¢˜ï¼‰  
        function renderNavigation() {  
            const navContainer = document.getElementById('navContainer');  
            if (documentStructure.length === 0) {  
                navContainer.innerHTML = `  
                    <div class="empty-state">  
                        <div class="empty-state-icon">ğŸ“­</div>  
                        <div>æš‚æ— å†…å®¹</div>  
                        <small>è¯·å¯¼å…¥ Markdown æ–‡ä»¶</small>  
                    </div>  
                `;  
                return;  
            }  

            let navHTML = '';  
            
            // å¦‚æœé€‰æ‹©äº†H2æ ‡ç­¾ï¼Œåªæ˜¾ç¤ºè¯¥H2çš„å­æ ‡é¢˜  
            if (activeTabId) {  
                const activeH2 = currentH2Tabs.find(tab => tab.id === activeTabId);  
                if (activeH2 && activeH2.children) {  
                    // æ˜¾ç¤ºH2æ ‡é¢˜  
                    navHTML += `<div class="nav-item" onclick="scrollToSection('${activeH2.id}')" style="font-weight: bold; background: #dbeafe;">${activeH2.title}</div>`;  
                    // æ˜¾ç¤ºH3å­æ ‡é¢˜  
                    activeH2.children.forEach(child => {  
                        navHTML += renderNavItem(child);  
                    });  
                }  
            } else {  
                // æ˜¾ç¤ºæ‰€æœ‰å†…å®¹  
                documentStructure.forEach(item => {  
                    navHTML += renderNavItem(item);  
                });  
            }  
            
            navContainer.innerHTML = navHTML || `  
                <div class="empty-state">  
                    <div class="empty-state-icon">ğŸ“­</div>  
                    <div>æš‚æ— å­ç« èŠ‚</div>  
                </div>  
            `;  
        }  

        // æ¸²æŸ“å•ä¸ªå¯¼èˆªé¡¹  
        function renderNavItem(item) {  
            let html = '';  
            const levelClass = item.level === 3 ? 'level-3' : '';  
            
            html += `<div class="nav-item ${levelClass}" onclick="scrollToSection('${item.id}')">  
                ${item.title}  
            </div>`;  
            
            return html;  
        }  

        // æ»šåŠ¨åˆ°æŒ‡å®šç« èŠ‚  
        function scrollToSection(id) {  
            const element = document.getElementById(id);  
            if (element) {  
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });  
                
                // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€  
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));  
                const navItem = document.querySelector(`[onclick="scrollToSection('${id}')"]`);  
                if (navItem) navItem.classList.add('active');  
            }  
        }  

        // æ¸²æŸ“å†…å®¹  
        function renderContent() {  
            const container = document.getElementById('contentContainer');  
            if (documentStructure.length === 0) {  
                container.innerHTML = `  
                    <div class="empty-state">  
                        <div class="empty-state-icon">ğŸ“„</div>  
                        <div>æš‚æ— æ–‡æ¡£</div>  
                        <small>å¯¼å…¥ Markdown æ–‡ä»¶åï¼Œå†…å®¹å°†åœ¨æ­¤å¤„æ˜¾ç¤º</small>  
                    </div>  
                `;  
                return;  
            }  

            let html = '';  
            
            // å¦‚æœé€‰æ‹©äº†H2æ ‡ç­¾ï¼Œåªæ˜¾ç¤ºè¯¥H2åŠå…¶å­å†…å®¹  
            if (activeTabId) {  
                const activeH2 = currentH2Tabs.find(tab => tab.id === activeTabId);  
                if (activeH2) {  
                    html = renderSection(activeH2);  
                }  
            } else {  
                // æ˜¾ç¤ºæ‰€æœ‰å†…å®¹  
                documentStructure.forEach(item => {  
                    html += renderSection(item);  
                });  
            }  
            
            container.innerHTML = html;  
        }  

        // æ¸²æŸ“å•ä¸ªç« èŠ‚ï¼ˆä¿®å¤ï¼šä¸é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹ï¼Œé¿å…é‡å¤è¯„å®¡åŒºåŸŸï¼‰  
        function renderSection(item) {  
            let html = '';  
            
            if (item.level === 3) {  
                const isTestCase = item.title.includes('TC-');  
                
                if (isTestCase) {  
                    // å¸¦TC-çš„æµ‹è¯•ç”¨ä¾‹  
                    html += `  
                        <div class="test-case" id="${item.id}">  
                            <div class="test-case-header">  
                                <div class="test-case-title">  
                                    <span>${item.title}</span>  
                                    <span class="badge badge-${item.priority}">${getPriorityText(item.priority)}</span>  
                                </div>  
                                <div class="test-case-actions">  
                                    <button class="action-btn action-btn-review" onclick="toggleReview('${item.id}')">  
                                        ğŸ’¬ è¯„å®¡  
                                    </button>  
                                </div>  
                            </div>  
                            <div class="content">  
                                ${renderContentArray(item.content)}  
                            </div>  
                            ${renderReviewSection(item.id)}  
                        </div>  
                    `;  
                } else {  
                    // æ™®é€šH3æ ‡é¢˜ï¼ˆä¹Ÿæœ‰è¯„å®¡æŒ‰é’®ï¼‰  
                    html += `  
                        <div class="section" id="${item.id}">  
                            <div class="section-header">  
                                <div class="section-title level-3">  
                                    ğŸ“™ ${item.title}  
                                </div>  
                                <div class="section-actions">  
                                    <button class="action-btn action-btn-review" onclick="toggleReview('${item.id}')">  
                                        ğŸ’¬ è¯„å®¡  
                                    </button>  
                                </div>  
                            </div>  
                            <div class="content">  
                                ${renderContentArray(item.content)}  
                            </div>  
                            ${renderReviewSection(item.id)}  
                        </div>  
                    `;  
                }  
            } else {  
                // H1, H2 æ ‡é¢˜  
                html += `  
                    <div class="section" id="${item.id}">  
                        <div class="section-header">  
                            <div class="section-title level-${item.level}">  
                                ${item.level === 1 ? 'ğŸ“˜' : 'ğŸ“—'} ${item.title}  
                            </div>  
                        </div>  
                        <div class="content">  
                            ${renderContentArray(item.content)}  
                        </div>  
                    </div>  
                `;  
            }  
            
            // é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹  
            if (item.children && item.children.length > 0) {  
                item.children.forEach(child => {  
                    html += renderSection(child);  
                });  
            }  
            
            return html;  
        }  

        // æ¸²æŸ“å†…å®¹æ•°ç»„  
        function renderContentArray(contentArray) {  
            if (!contentArray || contentArray.length === 0) return '';  

            let html = '';  
            let currentList = null;  
            let currentListType = null;  

            contentArray.forEach(item => {  
                if (item.type === 'table') {  
                    if (currentList) {  
                        html += `</${currentListType}>`;  
                        currentList = null;  
                        currentListType = null;  
                    }  
                    html += renderTable(item.content);  
                } else if (item.type === 'code') {  
                    if (currentList) {  
                        html += `</${currentListType}>`;  
                        currentList = null;  
                        currentListType = null;  
                    }  
                    html += `<pre><code>${escapeHtml(item.content)}</code></pre>`;  
                } else if (item.type === 'blockquote') {  
                    if (currentList) {  
                        html += `</${currentListType}>`;  
                        currentList = null;  
                        currentListType = null;  
                    }  
                    html += `<blockquote>${renderInlineMarkdown(item.content)}</blockquote>`;  
                } else if (item.type === 'heading') {  
                    if (currentList) {  
                        html += `</${currentListType}>`;  
                        currentList = null;  
                        currentListType = null;  
                    }  
                    html += `<h${item.level}>${renderInlineMarkdown(item.content)}</h${item.level}>`;  
                } else if (item.type === 'list') {  
                    const isOrdered = /^\d+\.\s/.test(item.content);  
                    const listType = isOrdered ? 'ol' : 'ul';  
                    const listContent = item.content.replace(/^[\*\-\d\.]\s+/, '');  
                    
                    if (currentListType !== listType) {  
                        if (currentList) {  
                            html += `</${currentListType}>`;  
                        }  
                        html += `<${listType}>`;  
                        currentListType = listType;  
                    }  
                    html += `<li>${renderInlineMarkdown(listContent)}</li>`;  
                    currentList = true;  
                } else if (item.type === 'paragraph') {  
                    if (currentList) {  
                        html += `</${currentListType}>`;  
                        currentList = null;  
                        currentListType = null;  
                    }  
                    html += `<p>${renderInlineMarkdown(item.content)}</p>`;  
                }  
            });  

            if (currentList) {  
                html += `</${currentListType}>`;  
            }  

            return html;  
        }  

        // æ¸²æŸ“è¡¨æ ¼  
        function renderTable(lines) {  
            if (lines.length < 2) return '';  

            let html = '<table>';  
            
            // è§£æè¡¨å¤´  
            const headerCells = lines[0].split('|').filter(cell => cell.trim());  
            html += '<thead><tr>';  
            headerCells.forEach(cell => {  
                html += `<th>${renderInlineMarkdown(cell.trim())}</th>`;  
            });  
            html += '</tr></thead>';  

            // è·³è¿‡åˆ†éš”è¡Œï¼Œå¤„ç†æ•°æ®è¡Œ  
            html += '<tbody>';  
            for (let i = 2; i < lines.length; i++) {  
                const cells = lines[i].split('|').filter(cell => cell.trim());  
                if (cells.length > 0) {  
                    html += '<tr>';  
                    cells.forEach(cell => {  
                        html += `<td>${renderInlineMarkdown(cell.trim())}</td>`;  
                    });  
                    html += '</tr>';  
                }  
            }  
            html += '</tbody></table>';  

            return html;  
        }  

        // æ¸²æŸ“å†…è” Markdown  
        function renderInlineMarkdown(text) {  
            // åŠ ç²—  
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');  
            // æ–œä½“  
            text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');  
            // è¡Œå†…ä»£ç   
            text = text.replace(/`(.+?)`/g, '<code>$1</code>');  
            // é“¾æ¥  
            text = text.replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank">$1</a>'); 
            // åˆ é™¤çº¿  
            text = text.replace(/~~(.+?)~~/g, '<del>$1</del>');  
            
            return text;  
        }  

        // HTML è½¬ä¹‰  
        function escapeHtml(text) {  
            const div = document.createElement('div');  
            div.textContent = text;  
            return div.innerHTML;  
        }  

        // è·å–ä¼˜å…ˆçº§æ–‡æœ¬  
        function getPriorityText(priority) {  
            const map = {  
                'critical': 'å…³é”®',  
                'high': 'é«˜',  
                'medium': 'ä¸­',  
                'low': 'ä½'  
            };  
            return map[priority] || 'ä½';  
        }  
		        // æ¸²æŸ“è¯„å®¡åŒºåŸŸ
        function renderReviewSection(id) {
            return `
                <div class="review-section" id="review-${id}">
                    <textarea class="review-input" placeholder="è¾“å…¥è¯„å®¡æ„è§..." id="review-input-${id}"></textarea>
                    <div class="review-footer">
                        <div class="review-meta">
                            <input type="text" placeholder="è¯„å®¡äºº" id="reviewer-${id}" value="åŒ¿å">
                            <input type="date" id="review-date-${id}" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div class="review-actions">
                            <button class="btn btn-primary" onclick="saveReview('${id}')">ğŸ’¾ ä¿å­˜è¯„å®¡</button>
                            <button class="btn btn-secondary" onclick="toggleReview('${id}')">âŒ å–æ¶ˆ</button>
                        </div>
                    </div>
                    <div class="review-list" id="review-list-${id}">
                        ${renderReviews(id)}
                    </div>
                </div>
            `;
        }

        // åˆ‡æ¢è¯„å®¡åŒºåŸŸ
        function toggleReview(id) {
            const reviewSection = document.getElementById(`review-${id}`);
            if (reviewSection) {
                reviewSection.classList.toggle('active');
            }
        }

        // ä¸€é”®æ˜¾ç¤º/éšè—æ‰€æœ‰è¯„å®¡
        let allReviewsVisible = false;
        let savedActiveTabId = null; // ä¿å­˜ä¹‹å‰çš„activeTabId
        
        function toggleAllReviews() {
            const btn = document.getElementById('toggleAllReviewsBtn');
            
            if (!allReviewsVisible) {
                // æ˜¾ç¤ºæ‰€æœ‰è¯„å®¡ï¼šæ¸…é™¤activeTabIdé™åˆ¶ï¼Œæ¸²æŸ“æ‰€æœ‰H2æ ‡ç­¾é¡µçš„å†…å®¹
                savedActiveTabId = activeTabId;
                activeTabId = null; // æ¸…é™¤é™åˆ¶ï¼Œæ¸²æŸ“æ‰€æœ‰æ ‡ç­¾é¡µçš„å†…å®¹
                renderContent(); // é‡æ–°æ¸²æŸ“æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬æ‰€æœ‰H2æ ‡ç­¾é¡µçš„è¯„å®¡åŒºåŸŸ
                renderNavigation(); // æ›´æ–°å¯¼èˆªï¼Œæ˜¾ç¤ºæ‰€æœ‰ç« èŠ‚
                
                // ç­‰å¾…DOMæ›´æ–°åï¼Œæ˜¾ç¤ºæ‰€æœ‰è¯„å®¡åŒºåŸŸ
                setTimeout(() => {
                    const allReviewSections = document.querySelectorAll('.review-section');
                    allReviewSections.forEach(section => {
                        section.classList.add('active');
                    });
                    
                    allReviewsVisible = true;
                    if (btn) {
                        btn.innerHTML = '<span>ğŸ™ˆ</span> éšè—æ‰€æœ‰è¯„å®¡';
                    }
                }, 50);
            } else {
                // éšè—æ‰€æœ‰è¯„å®¡ï¼šéšè—æ‰€æœ‰è¯„å®¡åŒºåŸŸï¼Œæ¢å¤ä¹‹å‰çš„æ ‡ç­¾é¡µçŠ¶æ€
                const allReviewSections = document.querySelectorAll('.review-section');
                allReviewSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // æ¢å¤ä¹‹å‰çš„activeTabId
                if (savedActiveTabId !== null) {
                    activeTabId = savedActiveTabId;
                } else if (currentH2Tabs.length > 0) {
                    activeTabId = currentH2Tabs[0].id;
                }
                
                renderContent(); // é‡æ–°æ¸²æŸ“ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„æ ‡ç­¾é¡µè§†å›¾
                renderNavigation(); // æ›´æ–°å¯¼èˆª
                
                // æ¢å¤æ ‡ç­¾é¡µçš„æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.h2-tab').forEach(tab => tab.classList.remove('active'));
                if (activeTabId) {
                    const activeTab = document.querySelector(`[onclick="switchH2Tab('${activeTabId}')"]`);
                    if (activeTab) activeTab.classList.add('active');
                }
                
                allReviewsVisible = false;
                if (btn) {
                    btn.innerHTML = '<span>ğŸ‘ï¸</span> æ˜¾ç¤ºæ‰€æœ‰è¯„å®¡';
                }
            }
        }

        // ä¿å­˜è¯„å®¡
        function saveReview(id) {
            const input = document.getElementById(`review-input-${id}`);
            const reviewer = document.getElementById(`reviewer-${id}`);
            const date = document.getElementById(`review-date-${id}`);
            
            const reviewText = input.value.trim();
            if (!reviewText) {
                alert('è¯·è¾“å…¥è¯„å®¡æ„è§');
                return;
            }

            if (!reviews[id]) {
                reviews[id] = [];
            }

            reviews[id].push({
                text: reviewText,
                reviewer: reviewer.value,
                date: date.value,
                timestamp: new Date().toISOString()
            });

            input.value = '';
            renderReviewList(id);
            updateStats();
        }

        // æ¸²æŸ“è¯„å®¡åˆ—è¡¨
        function renderReviews(id) {
            if (!reviews[id] || reviews[id].length === 0) {
                return '';
            }

            return reviews[id].map((review, index) => `
                <div class="review-item">
                    <div class="review-item-header">
                        <span>ğŸ‘¤ ${review.reviewer}</span>
                        <span>ğŸ“… ${review.date}</span>
                        <span style="cursor: pointer;" onclick="deleteReview('${id}', ${index})">ğŸ—‘ï¸</span>
                    </div>
                    <div class="review-item-content">${escapeHtml(review.text)}</div>
                </div>
            `).join('');
        }

        // æ›´æ–°è¯„å®¡åˆ—è¡¨
        function renderReviewList(id) {
            const container = document.getElementById(`review-list-${id}`);
            if (container) {
                container.innerHTML = renderReviews(id);
            }
        }

        // åˆ é™¤è¯„å®¡
        function deleteReview(id, index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„å®¡æ„è§å—ï¼Ÿ')) {
                reviews[id].splice(index, 1);
                renderReviewList(id);
                updateStats();
            }
        }

        // æ¸²æŸ“H2æ ‡ç­¾é¡µ
        function renderH2Tabs() {
            const tabsContainer = document.getElementById('h2TabsContainer');
            const tabsHeader = document.getElementById('h2TabsHeader');

            if (currentH2Tabs.length === 0) {
                tabsContainer.classList.remove('active');
                return;
            }

            tabsContainer.classList.add('active');

            // æ¸²æŸ“æ ‡ç­¾é¡µå¤´éƒ¨
            // ç¬¬1ä¸ªå’Œæœ€åä¸€ä¸ªæ ‡ç­¾ä¸æ˜¾ç¤ºæµ‹è¯•ç‚¹æ•°é‡
            tabsHeader.innerHTML = currentH2Tabs.map((h2, index) => {
                const isFirst = index === 0;
                const isLast = index === currentH2Tabs.length - 1;
                const showCount = !isFirst && !isLast;
                
                return `
                    <div class="h2-tab ${index === 0 && !activeTabId ? 'active' : (h2.id === activeTabId ? 'active' : '')}" onclick="switchH2Tab('${h2.id}')">
                        <div class="h2-tab-title">${h2.title}</div>
                        ${showCount ? `<div class="h2-tab-count">${h2.testCaseCount} ä¸ªæµ‹è¯•ç‚¹</div>` : ''}
                    </div>
                `;
            }).join('');

            // å¦‚æœæ²¡æœ‰æ¿€æ´»çš„æ ‡ç­¾ï¼Œé»˜è®¤æ¿€æ´»ç¬¬ä¸€ä¸ª
            if (!activeTabId && currentH2Tabs.length > 0) {
                activeTabId = currentH2Tabs[0].id;
            }
        }

        // åˆ‡æ¢H2æ ‡ç­¾é¡µ
        function switchH2Tab(tabId) {
            activeTabId = tabId;
            
            // æ›´æ–°æ ‡ç­¾é¡µæ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.h2-tab').forEach(tab => tab.classList.remove('active'));
            const activeTab = document.querySelector(`[onclick="switchH2Tab('${tabId}')"]`);
            if (activeTab) activeTab.classList.add('active');
            
            // é‡æ–°æ¸²æŸ“å¯¼èˆªå’Œå†…å®¹åŒºåŸŸ
            renderNavigation();
            renderContent();
            
            // æ»šåŠ¨åˆ°å†…å®¹åŒºåŸŸé¡¶éƒ¨
            const contentArea = document.querySelector('.content-area');
            if (contentArea) {
                contentArea.scrollTop = 0;
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            // æµ‹è¯•ç±»åˆ«æ•°ï¼ˆé™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªH2å¤–çš„H2æ•°é‡ï¼‰
            let categoryCount = 0;
            if (currentH2Tabs.length > 2) {
                categoryCount = currentH2Tabs.length - 2;
            }
            
            // è¯¦ç»†æµ‹è¯•ç‚¹æ•°ï¼ˆåªç»Ÿè®¡ä¸­é—´H2ä¸‹çš„H3æ•°é‡ï¼Œæ’é™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªH2ï¼‰
            let testCaseCount = 0;
            let criticalCount = 0;
            let highCount = 0;
            let mediumCount = 0;
            let lowCount = 0;
            
            // åªç»Ÿè®¡ä¸­é—´çš„H2ï¼ˆæ’é™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªï¼‰
            if (currentH2Tabs.length > 2) {
                for (let i = 1; i < currentH2Tabs.length - 1; i++) {
                    const h2 = currentH2Tabs[i];
                    if (h2.children) {
                        h2.children.forEach(h3 => {
                            if (h3.level === 3) {
                                testCaseCount++;
                                // ç»Ÿè®¡ä¼˜å…ˆçº§
                                if (h3.priority === 'critical') criticalCount++;
                                else if (h3.priority === 'high') highCount++;
                                else if (h3.priority === 'medium') mediumCount++;
                                else if (h3.priority === 'low') lowCount++;
                            }
                        });
                    }
                }
            }
            
            // è¯„å®¡æ„è§æ€»æ•°
            let totalReviews = 0;
            Object.values(reviews).forEach(reviewArray => {
                totalReviews += reviewArray.length;
            });
            
            // æ ‡ç­¾é¡µæ•°é‡ï¼ˆH2æ•°é‡ï¼‰
            const h2Count = currentH2Tabs.length;
            
            document.getElementById('categoryCount').textContent = categoryCount;
            document.getElementById('testCaseCount').textContent = testCaseCount;
            document.getElementById('criticalCount').textContent = criticalCount;
            document.getElementById('highCount').textContent = highCount;
            document.getElementById('mediumCount').textContent = mediumCount;
            document.getElementById('lowCount').textContent = lowCount;
            document.getElementById('reviewCount').textContent = totalReviews;
            document.getElementById('h2TabCount').textContent = h2Count;
        }

        // åˆ·æ–°æ–‡ä»¶
        function reloadFile() {
            if (currentFile) {
                reviews = {};
                currentH2Tabs = [];
                activeTabId = null;
                h1Title = '';
                loadMarkdownFile(currentFile);
            } else {
                alert('è¯·å…ˆå¯¼å…¥æ–‡ä»¶');
            }
        }

        // è·å–ç»Ÿè®¡æ•°æ®
        function getStatsData() {
            // æµ‹è¯•ç±»åˆ«æ•°ï¼ˆé™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªH2å¤–çš„H2æ•°é‡ï¼‰
            let categoryCount = 0;
            if (currentH2Tabs.length > 2) {
                categoryCount = currentH2Tabs.length - 2;
            }
            
            // è¯¦ç»†æµ‹è¯•ç‚¹æ•°ï¼ˆåªç»Ÿè®¡ä¸­é—´H2ä¸‹çš„H3æ•°é‡ï¼Œæ’é™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªH2ï¼‰
            let testCaseCount = 0;
            let criticalCount = 0;
            let highCount = 0;
            let mediumCount = 0;
            let lowCount = 0;
            
            // åªç»Ÿè®¡ä¸­é—´çš„H2ï¼ˆæ’é™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªï¼‰
            if (currentH2Tabs.length > 2) {
                for (let i = 1; i < currentH2Tabs.length - 1; i++) {
                    const h2 = currentH2Tabs[i];
                    if (h2.children) {
                        h2.children.forEach(h3 => {
                            if (h3.level === 3) {
                                testCaseCount++;
                                // ç»Ÿè®¡ä¼˜å…ˆçº§
                                if (h3.priority === 'critical') criticalCount++;
                                else if (h3.priority === 'high') highCount++;
                                else if (h3.priority === 'medium') mediumCount++;
                                else if (h3.priority === 'low') lowCount++;
                            }
                        });
                    }
                }
            }
            
            // è¯„å®¡æ„è§æ€»æ•°
            let totalReviews = 0;
            Object.values(reviews).forEach(reviewArray => {
                totalReviews += reviewArray.length;
            });
            
            // æ ‡ç­¾é¡µæ•°é‡ï¼ˆH2æ•°é‡ï¼‰
            const h2Count = currentH2Tabs.length;
            
            return {
                categoryCount,
                testCaseCount,
                criticalCount,
                highCount,
                mediumCount,
                lowCount,
                totalReviews,
                h2Count
            };
        }

        // ç”ŸæˆHTMLæ¨¡æ¿ï¼ˆå¸¦å·¦ä¾§å¯¼èˆªï¼‰
        function generateHTMLTemplate(contentHTML, navHTML, title, stats = null) {
            const styles = document.querySelector('style').innerHTML;
            
            // å¦‚æœæ²¡æœ‰ä¼ å…¥ç»Ÿè®¡æ•°æ®ï¼Œè‡ªåŠ¨è·å–
            if (!stats) {
                stats = getStatsData();
            }
            
            // ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯HTML
            const statsHTML = stats ? `
            <div style="background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: var(--shadow-md);">
                <h2 style="color: var(--primary-color); margin-bottom: 20px; font-size: 20px;">ğŸ“Š æ–‡æ¡£ç»Ÿè®¡æ•°æ®</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--primary-color);">${stats.categoryCount}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">æµ‹è¯•ç±»åˆ«</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--primary-color);">${stats.testCaseCount}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">è¯¦ç»†æµ‹è¯•ç‚¹</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--danger-color);">${stats.criticalCount}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">å…³é”®</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--warning-color);">${stats.highCount}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">é«˜</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: #ca8a04;">${stats.mediumCount}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">ä¸­</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: #0284c7;">${stats.lowCount}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">ä½</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--primary-color);">${stats.totalReviews}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">è¯„å®¡æ„è§</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--primary-color);">${stats.h2Count}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">æ ‡ç­¾é¡µ</div>
                    </div>
                </div>
            </div>
            ` : '';
            
            return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <style>
        ${styles}
        
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-primary);
        }
        
        .export-container {
            display: flex;
            min-height: 100vh;
        }
        
        .export-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            box-shadow: var(--shadow-md);
        }
        
        .export-content {
            margin-left: 280px;
            padding: 40px;
            flex: 1;
            background: var(--bg-primary);
        }
        
        .export-nav-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            color: var(--primary-color);
        }
        
        .export-nav-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: var(--bg-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-size: 14px;
            text-decoration: none;
            display: block;
            color: var(--text-primary);
        }
        
        .export-nav-item:hover {
            background: #e0e7ff;
            border-left-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .export-nav-item.level-2 {
            padding-left: 25px;
            font-size: 13px;
        }
        
        .export-nav-item.level-3 {
            padding-left: 40px;
            font-size: 12px;
        }
        
        .document-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        .document-header h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .document-info {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .document-info p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="export-container">
        <div class="export-sidebar">
            <div class="export-nav-title">ğŸ“‘ ç›®å½•å¯¼èˆª</div>
            ${navHTML}
        </div>
        
        <div class="export-content">
            <div class="document-header">
                <h1>${title}</h1>
                <div class="document-info">
                    <p>ğŸ“ æ–‡ä»¶: ${currentFileName}</p>
                    <p>ğŸ“… å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()}</p>
                </div>
            </div>
            
            ${statsHTML}
            
            ${contentHTML}
        </div>
    </div>
    
    <script>
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    <\/script>
</body>
</html>`;
        }

        // ç”Ÿæˆå¯¼èˆªHTMLï¼ˆé€’å½’ç”Ÿæˆæ‰€æœ‰å±‚çº§ï¼Œä¿®å¤IDé—®é¢˜ï¼‰
        function generateNavHTML(items, parentIndex = '') {
            let html = '';
            items.forEach((item, index) => {
                const currentIndex = parentIndex ? `${parentIndex}.${index + 1}` : `${index + 1}`;
                let levelClass = '';
                if (item.level === 2) levelClass = 'level-2';
                else if (item.level === 3) levelClass = 'level-3';
                
                html += `<a href="#${item.id}" class="export-nav-item ${levelClass}">${item.title}</a>`;
                
                if (item.children && item.children.length > 0) {
                    html += generateNavHTML(item.children, currentIndex);
                }
            });
            return html;
        }

        // å¯¼å‡º HTML å¸¦è¯„å®¡
        function exportHTMLWithReviews() {
            if (documentStructure.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹');
                return;
            }

            // ä¸´æ—¶æ¸…é™¤activeTabIdï¼Œå¯¼å‡ºæ‰€æœ‰å†…å®¹
            const tempActiveTabId = activeTabId;
            activeTabId = null;

            let contentHTML = '';
            documentStructure.forEach(item => {
                contentHTML += generateExportSection(item, true);
            });

            const navHTML = generateNavHTML(documentStructure);
            const exportTitle = h1Title || 'æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£';
            const stats = getStatsData();
            const html = generateHTMLTemplate(contentHTML, navHTML, `ğŸ“‹ ${exportTitle}ï¼ˆå«è¯„å®¡ï¼‰`, stats);
            downloadFile(html, `${exportTitle}_å¸¦è¯„å®¡.html`, 'text/html');

            // æ¢å¤activeTabId
            activeTabId = tempActiveTabId;
        }

        // å¯¼å‡º HTML æ— è¯„å®¡
        function exportHTMLWithoutReviews() {
            if (documentStructure.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹');
                return;
            }

            // ä¸´æ—¶æ¸…é™¤activeTabIdï¼Œå¯¼å‡ºæ‰€æœ‰å†…å®¹
            const tempActiveTabId = activeTabId;
            activeTabId = null;

            let contentHTML = '';
            documentStructure.forEach(item => {
                contentHTML += generateExportSection(item, false);
            });

            const navHTML = generateNavHTML(documentStructure);
            const exportTitle = h1Title || 'æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£';
            const stats = getStatsData();
            const html = generateHTMLTemplate(contentHTML, navHTML, `ğŸ“‹ ${exportTitle}`, stats);
            downloadFile(html, `${exportTitle}.html`, 'text/html');

            // æ¢å¤activeTabId
            activeTabId = tempActiveTabId;
        }

        // å¯¼å‡ºè¯„å®¡æ–‡æ¡£
        function exportHTMLReviewsOnly() {
            let totalReviews = 0;
            Object.values(reviews).forEach(r => totalReviews += r.length);

            if (totalReviews === 0) {
                alert('æ²¡æœ‰è¯„å®¡æ„è§å¯å¯¼å‡º');
                return;
            }

            let contentHTML = '';
            let navItems = [];

            function collectReviewedItems(item) {
                if (reviews[item.id] && reviews[item.id].length > 0) {
                    navItems.push(item);
                }
                if (item.children) {
                    item.children.forEach(child => collectReviewedItems(child));
                }
            }

            documentStructure.forEach(item => collectReviewedItems(item));

            // ç”Ÿæˆå¸¦è¯„å®¡çš„å†…å®¹HTML
            documentStructure.forEach(item => {
                contentHTML += generateExportSection(item, true, true);
            });

            const navHTML = generateNavHTML(navItems);
            const exportTitle = h1Title || 'æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£';
            const stats = getStatsData();
            const html = generateHTMLTemplate(contentHTML, navHTML, `ğŸ“ ${exportTitle}_è¯„å®¡æ„è§æ±‡æ€»`, stats);
            downloadFile(html, `${exportTitle}_è¯„å®¡æ„è§æ±‡æ€».html`, 'text/html');
        }
		        // ç”Ÿæˆå¯¼å‡ºç« èŠ‚HTMLï¼ˆä¿®å¤ï¼šæ­£ç¡®å¤„ç†å­èŠ‚ç‚¹ï¼Œé¿å…é‡å¤IDï¼‰
        function generateExportSection(item, includeReviews, reviewOnly = false) {
            let html = '';
            
            // å¦‚æœæ˜¯ä»…è¯„å®¡æ¨¡å¼ï¼Œä¸”å½“å‰èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹éƒ½æ²¡æœ‰è¯„å®¡ï¼Œåˆ™è·³è¿‡
            if (reviewOnly && !hasReviews(item)) {
                return '';
            }
            
            if (item.level === 3) {
                const isTestCase = item.title.includes('TC-');
                
                // ä»…è¯„å®¡æ¨¡å¼ä¸‹ï¼Œå¦‚æœå½“å‰é¡¹æ²¡æœ‰è¯„å®¡ï¼Œè·³è¿‡
                if (reviewOnly && (!reviews[item.id] || reviews[item.id].length === 0)) {
                    return '';
                }
                
                if (isTestCase) {
                    // å¸¦TC-çš„æµ‹è¯•ç”¨ä¾‹
                    html += `
                        <div class="test-case" id="${item.id}">
                            <div class="test-case-header">
                                <div class="test-case-title">
                                    <span>${item.title}</span>
                                    <span class="badge badge-${item.priority}">${getPriorityText(item.priority)}</span>
                                </div>
                            </div>
                            ${!reviewOnly ? `<div class="content">${renderContentArray(item.content)}</div>` : ''}
                            ${includeReviews && reviews[item.id] && reviews[item.id].length > 0 ? `
                                <div style="margin-top: 20px; padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--warning-color);">
                                    <h4 style="color: var(--warning-color); margin-bottom: 15px;">ğŸ“ è¯„å®¡æ„è§</h4>
                                    ${reviews[item.id].map(review => `
                                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid var(--primary-color);">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; color: var(--text-secondary);">
                                                <span>ğŸ‘¤ ${review.reviewer}</span>
                                                <span>ğŸ“… ${review.date}</span>
                                            </div>
                                            <div style="color: var(--text-primary); line-height: 1.6; white-space: pre-wrap;">${escapeHtml(review.text)}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    // æ™®é€šH3
                    html += `
                        <div class="section" id="${item.id}">
                            <div class="section-header">
                                <div class="section-title level-3">
                                    ğŸ“™ ${item.title}
                                </div>
                            </div>
                            ${!reviewOnly ? `<div class="content">${renderContentArray(item.content)}</div>` : ''}
                            ${includeReviews && reviews[item.id] && reviews[item.id].length > 0 ? `
                                <div style="margin-top: 20px; padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--warning-color);">
                                    <h4 style="color: var(--warning-color); margin-bottom: 15px;">ğŸ“ è¯„å®¡æ„è§</h4>
                                    ${reviews[item.id].map(review => `
                                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid var(--primary-color);">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; color: var(--text-secondary);">
                                                <span>ğŸ‘¤ ${review.reviewer}</span>
                                                <span>ğŸ“… ${review.date}</span>
                                            </div>
                                            <div style="color: var(--text-primary); line-height: 1.6; white-space: pre-wrap;">${escapeHtml(review.text)}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
            } else {
                // H1, H2 æ ‡é¢˜
                // ä»…è¯„å®¡æ¨¡å¼ä¸‹ï¼Œå¦‚æœå½“å‰é¡¹åŠå­é¡¹éƒ½æ²¡æœ‰è¯„å®¡ï¼Œè·³è¿‡
                if (reviewOnly && !hasReviews(item)) {
                    return '';
                }
                
                html += `
                    <div class="section" id="${item.id}">
                        <div class="section-header">
                            <div class="section-title level-${item.level}">
                                ${item.level === 1 ? 'ğŸ“˜' : 'ğŸ“—'} ${item.title}
                            </div>
                        </div>
                        ${!reviewOnly ? `<div class="content">${renderContentArray(item.content)}</div>` : ''}
                        ${includeReviews && reviews[item.id] && reviews[item.id].length > 0 ? `
                            <div style="margin-top: 20px; padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--warning-color);">
                                <h4 style="color: var(--warning-color); margin-bottom: 15px;">ğŸ“ è¯„å®¡æ„è§</h4>
                                ${reviews[item.id].map(review => `
                                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid var(--primary-color);">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; color: var(--text-secondary);">
                                            <span>ğŸ‘¤ ${review.reviewer}</span>
                                            <span>ğŸ“… ${review.date}</span>
                                        </div>
                                        <div style="color: var(--text-primary); line-height: 1.6; white-space: pre-wrap;">${escapeHtml(review.text)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // é€’å½’å¤„ç†å­èŠ‚ç‚¹
            if (item.children && item.children.length > 0) {
                item.children.forEach(child => {
                    html += generateExportSection(child, includeReviews, reviewOnly);
                });
            }

            return html;
        }

        // æ£€æŸ¥èŠ‚ç‚¹æˆ–å…¶å­èŠ‚ç‚¹æ˜¯å¦æœ‰è¯„å®¡
        function hasReviews(item) {
            if (reviews[item.id] && reviews[item.id].length > 0) {
                return true;
            }
            if (item.children && item.children.length > 0) {
                return item.children.some(child => hasReviews(child));
            }
            return false;
        }

        // å¯¼å‡º Markdown æ¨¡æ¿
        function exportMarkdownTemplate() {
            const template = `# æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£æ¨¡æ¿

## åŠŸèƒ½æ¦‚è§ˆ

### ğŸ’¡ åŠŸèƒ½è¯´æ˜

åœ¨æ­¤å¤„æè¿°åŠŸèƒ½çš„ä¸»è¦ä½œç”¨å’ŒèƒŒæ™¯ã€‚

**ä¸»è¦ä½œç”¨1ï¼š** åŠŸèƒ½æè¿°  
**ä¸»è¦ä½œç”¨2ï¼š** åŠŸèƒ½æè¿°

### ğŸ¯ æ”¯æŒèŒƒå›´

| é¡¹ç›® | é…ç½® | æ”¯æŒæƒ…å†µ | è¯´æ˜ |
|------|------|---------|------|
| é¡¹ç›®1 | é…ç½®1 | å®Œå…¨æ”¯æŒ | è¯¦ç»†è¯´æ˜ |
| é¡¹ç›®2 | é…ç½®2 | éƒ¨åˆ†æ”¯æŒ | è¯¦ç»†è¯´æ˜ |

### ğŸ”„ å·¥ä½œåŸç†

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—ï¼Œç”¨äºå¼ºè°ƒé‡è¦ä¿¡æ¯

#### 1. æ­£å¸¸æ¨¡å¼

\`\`\`
åœ¨æ­¤å¤„æ·»åŠ ç¤ºæ„å›¾æˆ–ä»£ç 
å¯ä»¥ä½¿ç”¨ ASCII å›¾å½¢
\`\`\`

#### 2. é™çº§æ¨¡å¼

\`\`\`python
def example():
    print("ä»£ç ç¤ºä¾‹")
\`\`\`

### âš ï¸ å…³é”®çº¦æŸ

- çº¦æŸæ¡ä»¶1
- çº¦æŸæ¡ä»¶2  
- çº¦æŸæ¡ä»¶3

---

## æµ‹è¯•ç”¨ä¾‹

### TC-MODULE-FUNC-001 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹æ ‡é¢˜ å…³é”®

#### ğŸ“‹ æµ‹è¯•ç›®çš„
æè¿°æµ‹è¯•çš„ä¸»è¦ç›®çš„å’ŒéªŒè¯ç‚¹ã€‚

#### ğŸ”§ é…ç½®è¯´æ˜

| å¯„å­˜å™¨ | åœ°å€ | ä½åŸŸ | åŠŸèƒ½ | é»˜è®¤å€¼ |
|--------|------|------|------|--------|
| REG_NAME | 0x1000 | [15:0] | åŠŸèƒ½æè¿° | 0x0000 |

#### ğŸ”¬ æµ‹è¯•æ­¥éª¤

1. æ­¥éª¤1ï¼šæ“ä½œæè¿°
2. æ­¥éª¤2ï¼šæ“ä½œæè¿°
3. æ­¥éª¤3ï¼šæ“ä½œæè¿°

#### âœ… é€šè¿‡æ ‡å‡†

- æ ‡å‡†1ï¼šæœŸæœ›ç»“æœ
- æ ‡å‡†2ï¼šæœŸæœ›ç»“æœ

---

### TC-MODULE-FUNC-002 å¦ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ é«˜

#### ğŸ“‹ æµ‹è¯•ç›®çš„
æµ‹è¯•ç›®çš„æè¿°ã€‚

#### ğŸ”¬ æµ‹è¯•æ­¥éª¤

- æ­¥éª¤1
- æ­¥éª¤2

#### âœ… é€šè¿‡æ ‡å‡†

1. æœŸæœ›ç»“æœ1
2. æœŸæœ›ç»“æœ2

---

## è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### TC-MODULE-BOUND-001 è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹ ä¸­

#### ğŸ“‹ æµ‹è¯•ç›®çš„
æµ‹è¯•è¾¹ç•Œæ¡ä»¶ä¸‹çš„ç³»ç»Ÿè¡Œä¸ºã€‚

#### ğŸ”¬ æµ‹è¯•æ­¥éª¤

1. é…ç½®åˆ°æœ€å¤§å€¼
2. é…ç½®åˆ°æœ€å°å€¼
3. éªŒè¯è¾¹ç•Œè¡Œä¸º

#### âœ… é€šè¿‡æ ‡å‡†

- è¾¹ç•Œå€¼å¤„ç†æ­£ç¡®
- æ— æº¢å‡ºæˆ–é”™è¯¯

---

### å…¶ä»–æµ‹è¯•ç‚¹

å¯ä»¥æ·»åŠ ä¸å¸¦TC-å‰ç¼€çš„æµ‹è¯•ç‚¹ï¼ŒåŒæ ·æ”¯æŒè¯„å®¡åŠŸèƒ½ã€‚

---

## ä½¿ç”¨è¯´æ˜

### ğŸ“ ç¼–å†™è§„èŒƒ

1. **æµ‹è¯•ç”¨ä¾‹IDå‘½å**ï¼šTC-[æ¨¡å—]-[åŠŸèƒ½]-[åºå·]
2. **ä¼˜å…ˆçº§æ ‡è¯†**ï¼šå…³é”®/é«˜/ä¸­/ä½
3. **ç« èŠ‚ç»“æ„**ï¼š
   - ä½¿ç”¨ # ä½œä¸ºä¸€çº§æ ‡é¢˜ï¼ˆå¯¼å‡ºhtmlæ–‡ä»¶çš„æ–‡ä»¶åï¼‰
   - ä½¿ç”¨ ## ä½œä¸ºäºŒçº§æ ‡é¢˜ï¼ˆä¼šæ˜¾ç¤ºä¸ºæ ‡ç­¾é¡µï¼‰
   - ä½¿ç”¨ ### ä½œä¸ºä¸‰çº§æ ‡é¢˜ï¼ˆè¯¦ç»†æµ‹è¯•ç‚¹ï¼Œæ‰€æœ‰ä¸‰çº§æ ‡é¢˜éƒ½æœ‰è¯„å®¡æŒ‰é’®ï¼‰
4. **è¡¨æ ¼æ ¼å¼**ï¼šæ ‡å‡† Markdown è¡¨æ ¼è¯­æ³•

### ğŸ¨ æ”¯æŒçš„ Markdown è¯­æ³•

- **åŠ ç²—**: \`**æ–‡æœ¬**\`
- *æ–œä½“*: \`*æ–‡æœ¬*\`
- \`è¡Œå†…ä»£ç \`: \`\\\`ä»£ç \\\`\`
- [é“¾æ¥](url): \`[æ–‡æœ¬](url)\`
- > å¼•ç”¨: \`> å¼•ç”¨å†…å®¹\`
- ~~åˆ é™¤çº¿~~: \`~~æ–‡æœ¬~~\`

### ğŸ“Š ç»Ÿè®¡è¯´æ˜

- **æµ‹è¯•ç±»åˆ«**ï¼šé™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªäºŒçº§æ ‡é¢˜å¤–çš„äºŒçº§æ ‡é¢˜æ•°é‡
- **è¯¦ç»†æµ‹è¯•ç‚¹**ï¼šé™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªäºŒçº§æ ‡é¢˜å¤–ï¼Œä¸­é—´äºŒçº§æ ‡é¢˜ä¸‹çš„ä¸‰çº§æ ‡é¢˜æ€»æ•°
- **ä¼˜å…ˆçº§ç»Ÿè®¡**ï¼šå…³é”®/é«˜/ä¸­/ä½ï¼Œåªç»Ÿè®¡ä¸­é—´äºŒçº§æ ‡é¢˜ä¸‹çš„ä¸‰çº§æ ‡é¢˜
- **æ ‡ç­¾é¡µ**ï¼šäºŒçº§æ ‡é¢˜æ•°é‡ï¼ˆç¬¬1ä¸ªå’Œæœ€å1ä¸ªä¸æ˜¾ç¤ºæµ‹è¯•ç‚¹æ•°é‡ï¼‰
- **ç« èŠ‚å¯¼èˆª**ï¼šåªæ˜¾ç¤ºå½“å‰é€‰ä¸­æ ‡ç­¾é¡µçš„ä¸‰çº§æ ‡é¢˜

### ğŸ“‹ ç¤ºä¾‹æ–‡æ¡£ç»“æ„

\`\`\`
# æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£æ ‡é¢˜ â† H1ï¼ˆä½œä¸ºå¯¼å‡ºæ–‡ä»¶åï¼‰
â”œâ”€â”€ ## åŠŸèƒ½æ¦‚è§ˆ â† H2ï¼ˆç¬¬1ä¸ªï¼Œä¸è®¡å…¥æµ‹è¯•ç±»åˆ«ï¼‰
â”‚   â””â”€â”€ ### åŠŸèƒ½è¯´æ˜ â† H3ï¼ˆä¸è®¡å…¥è¯¦ç»†æµ‹è¯•ç‚¹ï¼‰
â”œâ”€â”€ ## æµ‹è¯•ç”¨ä¾‹ â† H2ï¼ˆç¬¬2ä¸ªï¼Œè®¡å…¥æµ‹è¯•ç±»åˆ«ï¼‰
â”‚   â”œâ”€â”€ ### TC-001 æµ‹è¯•ç‚¹1 å…³é”® â† H3ï¼ˆè®¡å…¥è¯¦ç»†æµ‹è¯•ç‚¹å’Œä¼˜å…ˆçº§ç»Ÿè®¡ï¼‰
â”‚   â””â”€â”€ ### TC-002 æµ‹è¯•ç‚¹2 é«˜ â† H3ï¼ˆè®¡å…¥è¯¦ç»†æµ‹è¯•ç‚¹å’Œä¼˜å…ˆçº§ç»Ÿè®¡ï¼‰
â”œâ”€â”€ ## è¾¹ç•Œæµ‹è¯• â† H2ï¼ˆç¬¬3ä¸ªï¼Œè®¡å…¥æµ‹è¯•ç±»åˆ«ï¼‰
â”‚   â””â”€â”€ ### TC-003 æµ‹è¯•ç‚¹3 ä¸­ â† H3ï¼ˆè®¡å…¥è¯¦ç»†æµ‹è¯•ç‚¹å’Œä¼˜å…ˆçº§ç»Ÿè®¡ï¼‰
â””â”€â”€ ## ä½¿ç”¨è¯´æ˜ â† H2ï¼ˆæœ€å1ä¸ªï¼Œä¸è®¡å…¥æµ‹è¯•ç±»åˆ«ï¼‰
    â””â”€â”€ ### è¯´æ˜ â† H3ï¼ˆä¸è®¡å…¥è¯¦ç»†æµ‹è¯•ç‚¹ï¼‰
\`\`\`

---

*æ¨¡æ¿ç‰ˆæœ¬: 5.1*  
*æ›´æ–°æ—¥æœŸ: ${new Date().toLocaleDateString()}*
`;

            downloadFile(template, 'æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿.md', 'text/markdown');
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // å¯¼å‡ºè¯„å®¡ä¸ºTXTæ–‡ä»¶
        function exportReviewsTxt() {
            let totalReviews = 0;
            Object.values(reviews).forEach(r => totalReviews += r.length);

            if (totalReviews === 0) {
                alert('æ²¡æœ‰è¯„å®¡æ„è§å¯å¯¼å‡º');
                return;
            }

            // æ„å»ºTXTå†…å®¹
            let txtContent = '';
            txtContent += '========================================\n';
            txtContent += 'æµ‹è¯•ç”¨ä¾‹è¯„å®¡æ–‡ä»¶\n';
            txtContent += '========================================\n';
            txtContent += `å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()}\n`;
            txtContent += `æ–‡ä»¶: ${currentFileName || 'æœªå‘½åæ–‡ä»¶'}\n`;
            txtContent += `è¯„å®¡æ€»æ•°: ${totalReviews}\n`;
            txtContent += '========================================\n\n';

            // éå†æ‰€æœ‰è¯„å®¡
            const missingTitles = [];
            Object.keys(reviews).forEach(sectionId => {
                const sectionReviews = reviews[sectionId];
                if (sectionReviews && sectionReviews.length > 0) {
                    // æŸ¥æ‰¾å¯¹åº”çš„ç« èŠ‚æ ‡é¢˜
                    let sectionTitle = findSectionTitle(sectionId);
                    
                    // å¦‚æœæ‰¾ä¸åˆ°æ ‡é¢˜ï¼Œè®°å½•è­¦å‘Š
                    if (sectionTitle === 'æœªçŸ¥ç« èŠ‚') {
                        missingTitles.push(sectionId);
                        console.warn(`å¯¼å‡ºæ—¶æ— æ³•æ‰¾åˆ°ç« èŠ‚ID ${sectionId} çš„æ ‡é¢˜`);
                    }
                    
                    txtContent += `\nã€ç« èŠ‚ID: ${sectionId}ã€‘\n`;
                    txtContent += `ç« èŠ‚æ ‡é¢˜: ${sectionTitle}\n`;
                    txtContent += `${'='.repeat(50)}\n\n`;

                    sectionReviews.forEach((review, index) => {
                        txtContent += `è¯„å®¡ #${index + 1}\n`;
                        txtContent += `è¯„å®¡äºº: ${review.reviewer}\n`;
                        txtContent += `æ—¥æœŸ: ${review.date}\n`;
                        txtContent += `æ—¶é—´æˆ³: ${review.timestamp}\n`;
                        txtContent += `è¯„å®¡å†…å®¹:\n${review.text}\n`;
                        txtContent += `${'-'.repeat(50)}\n\n`;
                    });
                }
            });

            // å¦‚æœæœ‰æ‰¾ä¸åˆ°æ ‡é¢˜çš„ç« èŠ‚ï¼Œç»™å‡ºæç¤º
            if (missingTitles.length > 0) {
                console.warn(`å¯¼å‡ºæ—¶ï¼Œæœ‰ ${missingTitles.length} ä¸ªç« èŠ‚æ— æ³•æ‰¾åˆ°æ ‡é¢˜ï¼Œè¿™äº›è¯„å®¡åœ¨å¯¼å…¥æ—¶å¯èƒ½æ— æ³•æ­£ç¡®åŒ¹é…`);
            }

            txtContent += '\n========================================\n';
            txtContent += 'æ–‡ä»¶ç»“æŸ\n';
            txtContent += '========================================\n';

            const exportTitle = h1Title || 'æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£';
            downloadFile(txtContent, `${exportTitle}_è¯„å®¡æ„è§.txt`, 'text/plain');
        }

        // æŸ¥æ‰¾ç« èŠ‚æ ‡é¢˜ï¼ˆæ”¹è¿›ç‰ˆï¼šåœ¨æ‰€æœ‰å¯èƒ½çš„ä½ç½®æŸ¥æ‰¾ï¼‰
        function findSectionTitle(sectionId) {
            // é¦–å…ˆåœ¨documentStructureä¸­æŸ¥æ‰¾
            function searchInItems(items) {
                for (let item of items) {
                    if (item.id === sectionId) {
                        return item.title;
                    }
                    if (item.children && item.children.length > 0) {
                        const found = searchInItems(item.children);
                        if (found && found !== 'æœªçŸ¥ç« èŠ‚') return found;
                    }
                }
                return null;
            }
            
            let title = searchInItems(documentStructure);
            if (title) return title;
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°è¯•åœ¨currentH2Tabsä¸­æŸ¥æ‰¾ï¼ˆåŒ…æ‹¬æ‰€æœ‰H2æ ‡ç­¾é¡µï¼‰
            for (let h2 of currentH2Tabs) {
                if (h2.id === sectionId) {
                    return h2.title;
                }
                if (h2.children) {
                    for (let h3 of h2.children) {
                        if (h3.id === sectionId) {
                            return h3.title;
                        }
                    }
                }
            }
            
            // å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°è¯•é€šè¿‡IDç‰¹å¾æ¨æ–­ï¼ˆä½œä¸ºæœ€åæ‰‹æ®µï¼‰
            console.warn(`æ— æ³•æ‰¾åˆ°ç« èŠ‚ID ${sectionId} å¯¹åº”çš„æ ‡é¢˜`);
            return 'æœªçŸ¥ç« èŠ‚';
        }

        // ä»TXTæ–‡ä»¶å¯¼å…¥è¯„å®¡
        function importReviewsTxt(file) {
            // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½æ–‡æ¡£
            if (documentStructure.length === 0) {
                alert('è¯·å…ˆå¯¼å…¥æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£ï¼ˆMarkdownæ–‡ä»¶ï¼‰');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    console.log('å¼€å§‹è§£æè¯„å®¡æ–‡ä»¶...');
                    const importedCount = parseReviewsTxt(content);
                    console.log(`è§£æå®Œæˆï¼Œå°è¯•å¯¼å…¥ ${importedCount} æ¡è¯„å®¡`);
                    
                    if (importedCount === 0) {
                        alert('æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è¯„å®¡å†…å®¹');
                        return;
                    }
                    
                    // æ£€æŸ¥å¯¼å…¥çš„ç« èŠ‚IDæ˜¯å¦åœ¨å½“å‰æ–‡æ¡£ä¸­å­˜åœ¨
                    const missingSections = [];
                    const foundSections = [];
                    Object.keys(reviews).forEach(sectionId => {
                        if (findSectionInStructure(sectionId)) {
                            foundSections.push(sectionId);
                        } else {
                            missingSections.push(sectionId);
                        }
                    });
                    console.log('æ‰¾åˆ°çš„ç« èŠ‚ID:', foundSections);
                    console.log('æœªæ‰¾åˆ°çš„ç« èŠ‚ID:', missingSections);
                    
                    // ç»Ÿè®¡å®é™…æ˜ å°„æˆåŠŸçš„è¯„å®¡æ•°é‡
                    let actualMappedCount = 0;
                    Object.values(reviews).forEach(reviewArray => {
                        actualMappedCount += reviewArray.length;
                    });
                    console.log('å®é™…æ˜ å°„æˆåŠŸçš„è¯„å®¡æ•°é‡:', actualMappedCount);
                    
                    // å…ˆé‡æ–°æ¸²æŸ“å†…å®¹ï¼Œç¡®ä¿æ‰€æœ‰DOMå…ƒç´ å­˜åœ¨
                    // è¿™ä¼šä½¿ç”¨æœ€æ–°çš„reviewsæ•°æ®æ¥æ¸²æŸ“è¯„å®¡åˆ—è¡¨
                    renderContent();
                    
                    // ç¡®ä¿æ‰€æœ‰è¯„å®¡åˆ—è¡¨éƒ½å·²æ›´æ–°ï¼ˆåŒé‡ä¿é™©ï¼‰
                    setTimeout(() => {
                        Object.keys(reviews).forEach(id => {
                            const container = document.getElementById(`review-list-${id}`);
                            if (container) {
                                const reviewsHTML = renderReviews(id);
                                container.innerHTML = reviewsHTML;
                            }
                        });
                        updateStats();
                    }, 100);
                    
                    updateStats();
                    
                    let message = `è¯„å®¡æ–‡ä»¶å¯¼å…¥æˆåŠŸï¼\nå…±è§£æ ${importedCount} æ¡è¯„å®¡ï¼ŒæˆåŠŸæ˜ å°„ ${actualMappedCount} æ¡åˆ°å½“å‰æ–‡æ¡£`;
                    if (missingSections.length > 0) {
                        message += `\n\næ³¨æ„ï¼šæœ‰ ${missingSections.length} ä¸ªç« èŠ‚åœ¨å½“å‰æ–‡æ¡£ä¸­æœªæ‰¾åˆ°åŒ¹é…çš„æ ‡é¢˜`;
                    }
                    alert(message);
                } catch (error) {
                    alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
                    console.error('å¯¼å…¥é”™è¯¯:', error);
                }
            };
            reader.onerror = function() {
                alert('æ–‡ä»¶è¯»å–å¤±è´¥');
            };
            reader.readAsText(file);
        }

        // æ£€æŸ¥ç« èŠ‚æ˜¯å¦åœ¨æ–‡æ¡£ç»“æ„ä¸­å­˜åœ¨
        function findSectionInStructure(sectionId) {
            function searchInItems(items) {
                for (let item of items) {
                    if (item.id === sectionId) {
                        return true;
                    }
                    if (item.children && item.children.length > 0) {
                        if (searchInItems(item.children)) {
                            return true;
                        }
                    }
                }
                return false;
            }
            return searchInItems(documentStructure);
        }

        // è§£æè¯„å®¡TXTæ–‡ä»¶
        function parseReviewsTxt(content) {
            // ä¸´æ—¶å­˜å‚¨ï¼šæŒ‰æ ‡é¢˜å­˜å‚¨è¯„å®¡ï¼Œæœ€åå†æ˜ å°„åˆ°æ–°çš„ID
            const reviewsByTitle = {};
            let currentSectionTitle = null;
            let currentSectionId = null; // æ—§IDï¼Œä»…ç”¨äºä¸´æ—¶å­˜å‚¨
            let currentReview = null;
            let inReviewContent = false;
            let reviewContentLines = [];
            let importedCount = 0;

            const lines = content.split('\n');

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmedLine = line.trim();

                // è·³è¿‡ç©ºè¡Œ
                if (!trimmedLine) {
                    // å¦‚æœæ­£åœ¨æ”¶é›†è¯„å®¡å†…å®¹ï¼Œç©ºè¡Œä¹Ÿåº”è¯¥ä¿ç•™
                    if (inReviewContent && currentReview) {
                        reviewContentLines.push(line);
                    }
                    continue;
                }

                // è·³è¿‡åˆ†éš”çº¿ï¼ˆä½†éœ€è¦å¤„ç†ä½œä¸ºè¯„å®¡ç»“æŸæ ‡è®°çš„åˆ†éš”çº¿ï¼‰
                if (trimmedLine.match(/^[=\-]+$/)) {
                    // å¦‚æœé‡åˆ°åˆ†éš”çº¿ä¸”æ­£åœ¨æ”¶é›†è¯„å®¡å†…å®¹ï¼Œç»“æŸå½“å‰è¯„å®¡
                    if (inReviewContent && currentReview && currentSectionTitle) {
                        currentReview.text = reviewContentLines.join('\n').trim();
                        if (currentReview.text) {
                            if (!reviewsByTitle[currentSectionTitle]) {
                                reviewsByTitle[currentSectionTitle] = [];
                            }
                            reviewsByTitle[currentSectionTitle].push(currentReview);
                            importedCount++;
                        }
                        currentReview = null;
                        reviewContentLines = [];
                        inReviewContent = false;
                    }
                    continue;
                }

                // æ£€æµ‹ç« èŠ‚IDå’Œæ ‡é¢˜
                if (trimmedLine.startsWith('ã€ç« èŠ‚ID:') && trimmedLine.includes('ã€‘')) {
                    // ä¿å­˜ä¸Šä¸€ä¸ªè¯„å®¡ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (currentReview && currentSectionTitle && reviewContentLines.length > 0) {
                        currentReview.text = reviewContentLines.join('\n').trim();
                        if (currentReview.text) {
                            if (!reviewsByTitle[currentSectionTitle]) {
                                reviewsByTitle[currentSectionTitle] = [];
                            }
                            reviewsByTitle[currentSectionTitle].push(currentReview);
                            importedCount++;
                        }
                    }
                    
                    // è§£æç« èŠ‚IDï¼ˆæ—§IDï¼Œä»…ç”¨äºè®°å½•ï¼‰
                    const idMatch = trimmedLine.match(/ã€ç« èŠ‚ID:\s*([^\ã€‘]+)ã€‘/);
                    if (idMatch) {
                        currentSectionId = idMatch[1].trim();
                    }
                    currentSectionTitle = null; // é‡ç½®æ ‡é¢˜ï¼Œç­‰å¾…ä¸‹ä¸€è¡Œ
                    currentReview = null;
                    reviewContentLines = [];
                    inReviewContent = false;
                    continue;
                }

                // æ£€æµ‹ç« èŠ‚æ ‡é¢˜
                if (trimmedLine.startsWith('ç« èŠ‚æ ‡é¢˜:')) {
                    currentSectionTitle = trimmedLine.replace('ç« èŠ‚æ ‡é¢˜:', '').trim();
                    if (!reviewsByTitle[currentSectionTitle]) {
                        reviewsByTitle[currentSectionTitle] = [];
                    }
                    continue;
                }

                // æ£€æµ‹è¯„å®¡å¼€å§‹
                if (trimmedLine.startsWith('è¯„å®¡ #')) {
                    // ä¿å­˜ä¸Šä¸€ä¸ªè¯„å®¡
                    if (currentReview && currentSectionTitle && reviewContentLines.length > 0) {
                        currentReview.text = reviewContentLines.join('\n').trim();
                        if (currentReview.text) {
                            if (!reviewsByTitle[currentSectionTitle]) {
                                reviewsByTitle[currentSectionTitle] = [];
                            }
                            reviewsByTitle[currentSectionTitle].push(currentReview);
                            importedCount++;
                        }
                    }
                    // å¼€å§‹æ–°è¯„å®¡
                    currentReview = {
                        text: '',
                        reviewer: 'åŒ¿å',
                        date: new Date().toISOString().split('T')[0],
                        timestamp: new Date().toISOString()
                    };
                    reviewContentLines = [];
                    inReviewContent = false;
                    continue;
                }

                // è§£æè¯„å®¡å…ƒæ•°æ®
                if (currentReview && !inReviewContent) {
                    if (trimmedLine.startsWith('è¯„å®¡äºº:')) {
                        currentReview.reviewer = trimmedLine.replace('è¯„å®¡äºº:', '').trim() || 'åŒ¿å';
                        continue;
                    }
                    if (trimmedLine.startsWith('æ—¥æœŸ:')) {
                        const dateStr = trimmedLine.replace('æ—¥æœŸ:', '').trim();
                        if (dateStr) {
                            currentReview.date = dateStr;
                        }
                        continue;
                    }
                    if (trimmedLine.startsWith('æ—¶é—´æˆ³:')) {
                        const timestampStr = trimmedLine.replace('æ—¶é—´æˆ³:', '').trim();
                        if (timestampStr) {
                            currentReview.timestamp = timestampStr;
                        }
                        continue;
                    }
                    if (trimmedLine === 'è¯„å®¡å†…å®¹:') {
                        inReviewContent = true;
                        continue;
                    }
                }

                // æ”¶é›†è¯„å®¡å†…å®¹
                if (inReviewContent && currentReview) {
                    reviewContentLines.push(line); // ä¿ç•™åŸå§‹æ ¼å¼ï¼ŒåŒ…æ‹¬ç¼©è¿›å’Œç©ºè¡Œ
                }
            }

            // ä¿å­˜æœ€åä¸€ä¸ªè¯„å®¡
            if (currentReview && currentSectionTitle && reviewContentLines.length > 0) {
                currentReview.text = reviewContentLines.join('\n').trim();
                if (currentReview.text) {
                    if (!reviewsByTitle[currentSectionTitle]) {
                        reviewsByTitle[currentSectionTitle] = [];
                    }
                    reviewsByTitle[currentSectionTitle].push(currentReview);
                    importedCount++;
                }
            }

            // å°†æŒ‰æ ‡é¢˜å­˜å‚¨çš„è¯„å®¡æ˜ å°„åˆ°å½“å‰æ–‡æ¡£ä¸­çš„æ–°ID
            console.log('æŒ‰æ ‡é¢˜å­˜å‚¨çš„è¯„å®¡:', reviewsByTitle);
            const mappedCount = mapReviewsByTitleToIds(reviewsByTitle);
            console.log('æ˜ å°„åçš„reviewså¯¹è±¡:', reviews);
            console.log(`æˆåŠŸæ˜ å°„ ${mappedCount} æ¡è¯„å®¡åˆ°å½“å‰æ–‡æ¡£çš„ç« èŠ‚ID`);

            return importedCount;
        }

        // æ ¹æ®æ ‡é¢˜å°†è¯„å®¡æ˜ å°„åˆ°å½“å‰æ–‡æ¡£ä¸­çš„ç« èŠ‚ID
        function mapReviewsByTitleToIds(reviewsByTitle) {
            let mappedCount = 0;
            const unmappedTitles = [];

            // æ ‡å‡†åŒ–æ ‡é¢˜ï¼ˆå»é™¤emojiã€å¤šä½™ç©ºæ ¼ç­‰ï¼Œç”¨äºæ¨¡ç³ŠåŒ¹é…ï¼‰
            function normalizeTitle(title) {
                if (!title) return '';
                // å»é™¤emojiï¼ˆä¿ç•™ä¸­æ–‡å­—ç¬¦ã€è‹±æ–‡å­—æ¯ã€æ•°å­—ã€å¸¸è§æ ‡ç‚¹ï¼‰
                return title.replace(/[\u{1F300}-\u{1F9FF}]/gu, '').trim();
            }

            // é€’å½’æŸ¥æ‰¾ç« èŠ‚IDçš„å‡½æ•°ï¼ˆæ”¯æŒç²¾ç¡®åŒ¹é…å’Œæ¨¡ç³ŠåŒ¹é…ï¼‰
            function findIdByTitle(items, targetTitle, useFuzzy = false) {
                for (let item of items) {
                    let match = false;
                    if (useFuzzy) {
                        // æ¨¡ç³ŠåŒ¹é…ï¼šå»é™¤emojiåæ¯”è¾ƒ
                        const normalizedTarget = normalizeTitle(targetTitle);
                        const normalizedItem = normalizeTitle(item.title);
                        match = normalizedTarget === normalizedItem && normalizedTarget.length > 0;
                    } else {
                        // ç²¾ç¡®åŒ¹é…
                        match = item.title === targetTitle;
                    }
                    
                    if (match) {
                        return item.id;
                    }
                    if (item.children && item.children.length > 0) {
                        const found = findIdByTitle(item.children, targetTitle, useFuzzy);
                        if (found) return found;
                    }
                }
                return null;
            }

            // éå†æ‰€æœ‰æŒ‰æ ‡é¢˜å­˜å‚¨çš„è¯„å®¡
            Object.keys(reviewsByTitle).forEach(title => {
                // è·³è¿‡"æœªçŸ¥ç« èŠ‚"
                if (title === 'æœªçŸ¥ç« èŠ‚') {
                    console.warn('è·³è¿‡"æœªçŸ¥ç« èŠ‚"çš„è¯„å®¡ï¼Œå› ä¸ºæ— æ³•ç¡®å®šå¯¹åº”çš„ç« èŠ‚');
                    unmappedTitles.push(title);
                    return;
                }

                // å…ˆå°è¯•ç²¾ç¡®åŒ¹é…
                let sectionId = findIdByTitle(documentStructure, title, false);
                
                // å¦‚æœç²¾ç¡®åŒ¹é…å¤±è´¥ï¼Œå°è¯•æ¨¡ç³ŠåŒ¹é…
                if (!sectionId) {
                    sectionId = findIdByTitle(documentStructure, title, true);
                }

                if (sectionId) {
                    // æ‰¾åˆ°åŒ¹é…çš„ç« èŠ‚IDï¼Œå°†è¯„å®¡æ·»åŠ åˆ°reviewså¯¹è±¡
                    if (!reviews[sectionId]) {
                        reviews[sectionId] = [];
                    }
                    // åˆå¹¶è¯„å®¡ï¼ˆé¿å…é‡å¤ï¼‰
                    reviewsByTitle[title].forEach(review => {
                        reviews[sectionId].push(review);
                        mappedCount++;
                    });
                    console.log(`æˆåŠŸåŒ¹é…æ ‡é¢˜ "${title}" åˆ°ç« èŠ‚ID ${sectionId}`);
                } else {
                    unmappedTitles.push(title);
                    console.warn(`æ— æ³•åŒ¹é…æ ‡é¢˜: "${title}"`);
                }
            });

            if (unmappedTitles.length > 0) {
                console.warn('ä»¥ä¸‹ç« èŠ‚æ ‡é¢˜åœ¨å½“å‰æ–‡æ¡£ä¸­æœªæ‰¾åˆ°åŒ¹é…:', unmappedTitles);
            }

            return mappedCount;
        }

        // åˆå§‹åŒ–
        updateStats();
    </script>
</body>
</html>